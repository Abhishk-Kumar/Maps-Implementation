<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapify</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="map"></div>

    <div id="controls">
        <div class="control-row">
            <button id="playPauseButton" data-hover="Play Animation">Play</button>
            <select id="dateSelector"></select> 
        </div>
        <div id="currentDate"></div> 
        <div id="spinner"></div> 
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-tilelayer-gibs/leaflet-tilelayer-gibs.js"></script>

    <script>
        
        const map = L.map('map').setView([20.5937, 78.9629], 5);

        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        
        function getLast7Days() {
            const today = new Date();
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
            }
            return dates.reverse(); // Oldest first
        }

        const dates = getLast7Days();
        let currentIndex = 0;
        let playInterval = null;

        
        const dateSelector = document.getElementById('dateSelector');
        dates.forEach((date, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = date;
            dateSelector.appendChild(option);
        });

        
        function showSpinner(show) {
            const spinner = document.getElementById('spinner');
            spinner.style.display = show ? 'block' : 'none';
        }

        
        function addGIBSLayer(date) {
            if (window.gibsLayer) {
                map.removeLayer(window.gibsLayer); 
            }
            showSpinner(true); 
            window.gibsLayer = L.tileLayer(`https://gibs.earthdata.nasa.gov/wmts/epsg4326/best/MODIS_Terra_CorrectedReflectance_TrueColor/default/${date}/250m/{z}/{y}/{x}.jpg`, {
                attribution: 'NASA GIBS',
                tileSize: 256,
                zoomOffset: 1,
                maxZoom: 7,
                bounds: [[-85.05112877980659, -180], [85.0511287798066, 180]]
            }).on('load', function() {
                showSpinner(false); // Hide spinner once loaded
            }).addTo(map);
            document.getElementById('currentDate').innerText = `Showing date: ${date}`;
        }

        
        function updateLayer() {
            const selectedDate = dates[currentIndex];
            addGIBSLayer(selectedDate);
            currentIndex = (currentIndex + 1) % dates.length; 
        }

        
        function togglePlayPause() {
            const button = document.getElementById('playPauseButton');
            const spinner = document.getElementById('spinner');
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
                button.innerText = "Play";
                button.style.backgroundColor = "lightgreen";
                button.setAttribute('data-hover', 'Play Animation');
                spinner.style.borderTopColor = "#ffffff"; 
            } else {
                playInterval = setInterval(updateLayer, 3000); 
                button.innerText = "Pause";
                button.style.backgroundColor = "lightgrey";
                button.setAttribute('data-hover', 'Pause Animation');
                spinner.style.borderTopColor = "#00FF00"; 
                updateLayer(); 
            }
        }

       
        dateSelector.addEventListener('change', function() {
            currentIndex = parseInt(this.value);
            addGIBSLayer(dates[currentIndex]); 
        });

       
        addGIBSLayer(dates[currentIndex]);
        document.getElementById('playPauseButton').addEventListener('click', togglePlayPause);

    </script>
</body>
</html>
